---
title: "Convert .CSV Google Sheets to Latex"
output: html_notebook
---

```{r}
library(tidyverse)
library(jsonlite)
library(glue)
```


```{r}
df_videos <- read_csv("data/Elliptic Billiards Media - videos.csv")
```

```{r}
clean_video <- function(str) {
  str %>%
    str_remove_all('http[s?]://youtu\\.be/') %>%
    str_replace_all(fixed('_'),'\\_')
}

make_bibtex_entry <- function(df) {
  df_str <- df %>% mutate(str=glue("\\item \\textit{{{Title}}}, {Year}. youtu.be/\\href{{{Video1}}}{{\\nolinkurl{{{clean_video(Video1)}}}}}"))
  df_coll <- df_str$str %>% str_c(collapse="\n")
  glue("\\begin{{enumerate}}[resume]\n{df_coll}\n\\end{{enumerate}}\n")
}

make_bibtex <- function(df,key) {
  glue("\\section{{{key} ({nrow(df)})}\n\n{make_bibtex_entry(df)}\n\n")
}
```

Make an itemize for each group.

```{r}
list_videos <- df_videos %>%
  group_by(Section) %>%
  group_map(make_bibtex)
list_videos %>% head(3)
```

Combine all strings.

```{r}
str_videos <- list_videos %>%
  map_chr(~.x) %>%
  str_c(collapse="\n") %>%
  str_replace_all(fixed("&"),"\\&")
```

Needs to use the "enumitem" package:

```{r}
glue("{read_file('data/preamble.txt')}",
     "{str_videos}",
     "\\end{{document}}\n") %>%
  write_file("data/main.tex")
```


